<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Scoping Study</title>

    <script src="https://www.gstatic.com/charts/loader.js"></script>

    <script>
      google.charts.load('current', { packages: ['corechart'] });
      google.charts.setOnLoadCallback(draw);

      async function draw() {
        const csvUrl =
          'https://docs.google.com/spreadsheets/d/e/2PACX-1vSHkysTN6roFag5cFJv97rmXIsO9vKLKaAXmJxbeAD0v4klws329T8nwBI1ftUFKvrukkvLYM9vPysK/pub?gid=1283363545&single=true&output=csv';

        const res = await fetch(csvUrl);
        const csv = await res.text();

        const rows = csv
          .trim()
          .split('\n')
          .filter(r => r.trim().length > 0);

        const data = new google.visualization.DataTable();

        // Eixo X categÃ³rico
        data.addColumn('string', 'Project');

        // SÃ©ries
        data.addColumn('number', 'Measured + Indicated (%)');
        data.addColumn('number', 'Proved + Probable / Measured + Indicated (%)');

        // Tooltip HTML
        data.addColumn({
          type: 'string',
          role: 'tooltip',
          p: { html: true }
        });

        // Link oculto para clique
        data.addColumn('string', 'source_link');

        for (let i = 1; i < rows.length; i++) {
          const r = rows[i].split(',').map(c =>
            c.replace(/"/g, '').trim()
          );

          if (r.length < 6) continue;

          const name = r[0];
          const mi = parseFloat(r[1]); // 0â€“1
          const ppmi = parseFloat(r[2]); // 0â€“1
          const resources = r[3];
          const oreType = r[4];
          const source = r[5];

          if (isNaN(mi) || isNaN(ppmi)) continue;

          const tooltip = `
            <div style="padding:10px; max-width:260px;">
              <strong>${name}</strong><br><br>
              <b>Measured + Indicated:</b> ${(mi * 100).toFixed(1)}%<br>
              <b>P+P / M+I:</b> ${(ppmi * 100).toFixed(1)}%<br>
              <b>Resources:</b> ${resources} Mt<br>
              <b>Ore Type:</b> ${oreType}<br>
              <i>Click the point to open source</i>
            </div>
          `;

          data.addRow([name, mi, ppmi, tooltip, source]);
        }

        const options = {
          title: 'Scoping Study',
          height: 500,
          pointSize: 8,
          tooltip: { isHtml: true },
          legend: { position: 'right' },
          hAxis: {
            title: 'Projects',
            slantedText: true,
            slantedTextAngle: 45
          },
          vAxis: {
            title: 'Ratio (%)',
            minValue: 0,
            maxValue: 1,
            format: 'percent'
          },
          series: {
            0: { color: '#3366cc' }, // azul
            1: { color: '#dc3912' }  // vermelho
          }
        };

        const chart = new google.visualization.ScatterChart(
          document.getElementById('chart')
        );

        // ðŸ‘‰ Clique funcional no ponto
        google.visualization.events.addListener(chart, 'select', function () {
          const selection = chart.getSelection();
          if (!selection.length) return;

          const row = selection[0].row;
          const link = data.getValue(row, 4);

          if (link) {
            window.open(link, '_blank');
          }
        });

        chart.draw(data, options);
      }
    </script>
  </head>

  <body>
    <div id="chart"></div>
  </body>
</html>



